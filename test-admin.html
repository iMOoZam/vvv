<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ³Øª Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <style>
      body {
        font-family: "Vazirmatn", sans-serif;
        background: #f8f9fa;
        padding: 20px;
        direction: rtl;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .btn {
        padding: 12px 24px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-primary {
        background: #667eea;
        color: white;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .status {
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
        font-weight: 600;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .form-group {
        margin: 15px 0;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .form-group input {
        width: 100%;
        padding: 10px;
        border: 2px solid #e1e5e9;
        border-radius: 5px;
        font-size: 16px;
      }
      .form-group input:focus {
        outline: none;
        border-color: #667eea;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”§ ØªØ³Øª Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>

      <div id="status" class="status info">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª...</div>

      <div id="loginSection" style="display: none">
        <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h2>
        <form id="loginForm">
          <div class="form-group">
            <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
            <input type="text" id="username" value="admin" required />
          </div>
          <div class="form-group">
            <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
            <input type="password" id="password" value="admin123" required />
          </div>
          <button type="submit" class="btn btn-primary">ÙˆØ±ÙˆØ¯</button>
        </form>
      </div>

      <div id="adminSection" style="display: none">
        <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
        <div id="userInfo"></div>
        <button onclick="goToAdminPanel()" class="btn btn-success">
          Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
        </button>
        <button onclick="logout()" class="btn btn-danger">Ø®Ø±ÙˆØ¬</button>
      </div>

      <div id="testSection">
        <h2>ØªØ³Øª API</h2>
        <button onclick="testProducts()" class="btn btn-primary">
          ØªØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª
        </button>
        <button onclick="testUsers()" class="btn btn-primary">
          ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        </button>
        <div id="testResults"></div>
      </div>
    </div>

    <script>
      const API_BASE_URL = "http://localhost:3000/api";

      // Check current status
      async function checkStatus() {
        const statusDiv = document.getElementById("status");
        const loginSection = document.getElementById("loginSection");
        const adminSection = document.getElementById("adminSection");

        const token = localStorage.getItem("token");
        const currentUser = localStorage.getItem("currentUser");

        if (token && currentUser) {
          try {
            const response = await fetch(`${API_BASE_URL}/user`, {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });

            if (response.ok) {
              const user = await response.json();
              if (user.role === "admin") {
                statusDiv.className = "status success";
                statusDiv.innerHTML = `âœ… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…Ø¯ÛŒØ±: ${user.firstName} ${user.lastName}`;
                loginSection.style.display = "none";
                adminSection.style.display = "block";
                document.getElementById("userInfo").innerHTML = `
                                <p><strong>Ù†Ø§Ù…:</strong> ${user.firstName} ${
                  user.lastName
                }</p>
                                <p><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> ${user.email}</p>
                                <p><strong>Ù†Ù‚Ø´:</strong> ${
                                  user.role === "admin" ? "Ù…Ø¯ÛŒØ±" : "Ú©Ø§Ø±Ø¨Ø±"
                                }</p>
                            `;
              } else {
                statusDiv.className = "status error";
                statusDiv.innerHTML = "âŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ù…Ø§ Ù…Ø¯ÛŒØ± Ù†ÛŒØ³ØªÛŒØ¯";
                loginSection.style.display = "block";
                adminSection.style.display = "none";
              }
            } else {
              throw new Error("Token invalid");
            }
          } catch (error) {
            statusDiv.className = "status error";
            statusDiv.innerHTML = "âŒ ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª";
            loginSection.style.display = "block";
            adminSection.style.display = "none";
          }
        } else {
          statusDiv.className = "status info";
          statusDiv.innerHTML = "â„¹ï¸ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯";
          loginSection.style.display = "block";
          adminSection.style.display = "none";
        }
      }

      // Login form
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          try {
            const response = await fetch(`${API_BASE_URL}/login`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            });

            const data = await response.json();

            if (response.ok) {
              localStorage.setItem("token", data.token);
              localStorage.setItem("currentUser", JSON.stringify(data.user));
              checkStatus();
            } else {
              alert("Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: " + data.message);
            }
          } catch (error) {
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±");
          }
        });

      // Test products API
      async function testProducts() {
        const resultsDiv = document.getElementById("testResults");
        const token = localStorage.getItem("token");

        if (!token) {
          resultsDiv.innerHTML = `
                    <div class="status error">
                        âŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
                    </div>
                `;
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/products`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            const products = await response.json();
            resultsDiv.innerHTML = `
                        <div class="status success">
                            âœ… Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ${products.length} Ù…Ø­ØµÙˆÙ„
                            <br><small>${products
                              .map((p) => p.name)
                              .join(", ")}</small>
                        </div>
                    `;
          } else {
            const error = await response.json();
            resultsDiv.innerHTML = `
                        <div class="status error">
                            âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª: ${error.message}
                        </div>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="status error">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª: ${error.message}
                    </div>
                `;
        }
      }

      // Test users API
      async function testUsers() {
        const resultsDiv = document.getElementById("testResults");
        const token = localStorage.getItem("token");

        if (!token) {
          resultsDiv.innerHTML = `
                    <div class="status error">
                        âŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
                    </div>
                `;
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/users`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            const users = await response.json();
            resultsDiv.innerHTML = `
                        <div class="status success">
                            âœ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ${users.length} Ú©Ø§Ø±Ø¨Ø±
                            <br><small>${users
                              .map((u) => u.firstName + " " + u.lastName)
                              .join(", ")}</small>
                        </div>
                    `;
          } else {
            const error = await response.json();
            resultsDiv.innerHTML = `
                        <div class="status error">
                            âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: ${error.message}
                        </div>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="status error">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${error.message}
                    </div>
                `;
        }
      }

      // Go to admin panel
      function goToAdminPanel() {
        window.open("admin.html", "_blank");
      }

      // Logout
      function logout() {
        localStorage.removeItem("token");
        localStorage.removeItem("currentUser");
        checkStatus();
      }

      // Initialize
      checkStatus();
    </script>
  </body>
</html>
